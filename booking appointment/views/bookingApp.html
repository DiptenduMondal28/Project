<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Page</title>
    <link rel="stylesheet" href="/css/main.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <header style="color: red;">
        <h1>Booking your appointment</h1>
    </header>
    <section class="container">
        <form id="my-form" onsubmit="myFunc(event)">
            <h2 style="color: brown;">users</h2>

            <div>
                <label for="name">Name:</label>
                <input type="text" id="name" >
            </div>
            <div>
                <label for="email">Email:</label>
                <input type="text" id="email" >
            </div>
            <div>
                <label for="number">phone number:</label>
                <input type="number" id="phone" >
            </div>
            <div>
                <label for="datetime">tentative date span:</label>
                <input type="datetime-local" id="date" >
            </div>
            <input class="btn" type="submit" value="Submit">
        </form>
        <ul id="users"></ul>
      </section>
      <script>
        function myFunc(event){
    event.preventDefault();
    let details={
        name:document.getElementById('name').value,
        email:document.getElementById('email').value,
        phone:document.getElementById('phone').value,
        date:document.getElementById('date').value
    };
    let myDetails=JSON.stringify(details);
    localStorage.setItem(details.name,myDetails);   
    axios.post("https://localhost:3000",details)
        .then((response)=>{
            console.log(response)
        }).catch((err)=>{
            console.log(err)
        })
        document.getElementById('name').value=null;
        document.getElementById('email').value=null;
        document.getElementById('phone').value=null;
        document.getElementById('date').value=null;

}

window.addEventListener("DOMContentLoaded",()=>{
    axios.get("https://localhost:3000").then((response)=>{
        console.log(response);
        for(var i=0;i<response.data.length;i++){
            showDeleteEdit(response.data[i])
        }
    }).catch((err)=>{
        console.log(err)
    })

    const localStorageObj=localStorage;
    const localStorageKeys=Object.keys(localStorageObj);

    for(var i=0;i<localStorageKeys.length;i++){
        const key=localStorageKeys[i];
        const userDetailsString=localStorageObj[key];
        const userDetailsObj=JSON.parse(userDetailsString);

    }
})

function showDeleteEdit(details){
    let user=document.getElementById('users');
    //creating user list
    let userList=document.createElement('li');
    userList.textContent="Name:"+details.name+" Email:"+details.email+"  phone_Number:"+details.phone+"   date"+details.date+" id:"+details._id;

    //add delete button
    let deleteButton=document.createElement('input');
    deleteButton.type='button';
    deleteButton.value='delete';
    deleteButton.onclick=()=>{
        let element="https://localhost:3000"+details._id
        axios.delete(element)
        localStorage.removeItem(details.name);
        user.removeChild(userList);
    }

    let editButton=document.createElement('input');
    editButton.type='button';
    editButton.value='Edit';
    editButton.onclick=()=>{
        document.getElementById('name').value=details.name;
        document.getElementById('email').value=details.email;
        document.getElementById('phone').value=details.phone;
        document.getElementById('date').value=details.date;
        let element="https://localhost:3000"+details._id
        axios.delete(element)
        localStorage.removeItem(details.name);
        user.removeChild(userList);
    }


    userList.appendChild(deleteButton);
    userList.appendChild(editButton);
    user.appendChild(userList);
}
      </script>
</body>
</html>